ALERT containerMissing
    IF absent(((time() - container_last_seen{name="cadvisor"}) < 5)) FOR 5s
    LABELS { severity="page" }
    ANNOTATIONS {
      SUMMARY = "Instance {{$labels.instance}} down",
      DESCRIPTION = "Instance= {{$labels.instance}}, Service/Job ={{$labels.job}} is down for more than 2 sec."
    }

ALERT containerSpinLoop
    IF container_start_time_seconds{name="cadvisor"} < 5 FOR 10s
    LABELS { severity="page" }
    ANNOTATIONS {
      SUMMARY = "Instance {{$labels.instance}} stuck in restart loop",
      DESCRIPTION = "Instance= {{$labels.instance}}, Service/Job ={{$labels.job}} has been restarting for 10 sec."
    }

ALERT DiskWillFillIn4Hours
   IF predict_linear(node_filesystem_free{job='node',mountpoint='/'}[1h], 4*3600) < 0 FOR 5m
    LABELS { severity="page" }

# Alert for any instance that is unreachable for >5 minutes.
ALERT InstanceDown
  IF up == 0
  FOR 5m
  LABELS { severity = "page" }
  ANNOTATIONS {
    summary = "Instance {{ $labels.instance }} down",
    description = "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.",
  }

ALERT high_cpu_load
  IF node_load1 > 1.5
  FOR 30s
  LABELS { severity = "warning" }
  ANNOTATIONS {
      summary = "Server under high load",
      description = "Docker host is under high load, the avg load 1m is at {{ $value}}. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}.",
  }

ALERT high_memory_load
  IF (sum(node_memory_MemTotal) - sum(node_memory_MemFree + node_memory_Buffers + node_memory_Cached) ) / sum(node_memory_MemTotal) * 100 > 85
  FOR 30s
  LABELS { severity = "warning" }
  ANNOTATIONS {
      summary = "Server memory is almost full",
      description = "Docker host memory usage is {{ humanize $value}}%. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}.",
  }
